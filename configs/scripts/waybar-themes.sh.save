#!/bin/bash

# ADVERTENCE
# SCRIPT STILL IN DEVELOPMENT -IF ANYTHING BREAKS
# LET ME KNOW ON GITHUB: https://github.com/KorvekTw
# THE CODE ZEPHAR. SELECTED WAYBAR PROFILES
# THEMES THREE
# I'm just starting out, so the script isn't prefect. 
# I wrote it without using AI. Suggestions are welcome - and 
# if it's not to your liking, feel free to tweak it!
# SORRY

# GO INTO THE WAYBAR FOLDER IN YOUR HOME DIRECTORY.


# Configuración básica
THEMES_DIR="$HOME/.config/waybar/themes"
CACHE_DIR="$HOME/.cache/waybar-themes"
CURRENT_THEME="$CACHE_DIR/current_theme"

# Asegurar que existe el directorio cache
mkdir -p "$CACHE_DIR

# Verificar directorio de temas
if [ ! -d "$THEMES_DIR" ]; then
    notify-send "Error" "No se encontró el directorio de temas" -u critical
    exit 1
fi

# Obtener lista de temas disponibles
themes=($(find "$THEMES_DIR" -mindepth 1 -maxdepth 1 -type d -printf "%f\n" | sort))

# Verificar si hay temas
if [ ${#themes[@]} -eq 0 ]; then
    notify-send "Error" "No hay temas disponibles" -u critical
    exit 1
fi

# Obtener tema actual o usar el primero
current_theme=$(cat "$CURRENT_THEME" 2>/dev/null || echo "${themes[0]}")

# Encontrar el índice del tema actual
current_index=0
for i in "${!themes[@]}"; do
    if [[ "${themes[$i]}" == "${current_theme}" ]]; then
        current_index=$i
        break
    fi
done

# Calcular siguiente tema (volver al primero si es el último)
next_index=$(( (current_index + 1) % ${#themes[@]} ))
next_theme="${themes[$next_index]}"

# Verificar que el tema siguiente existe
if [ ! -d "$THEMES_DIR/$next_theme" ]; then
    next_theme="${themes[0]}"
fi

# Guardar nuevo tema
echo "$next_theme" > "$CURRENT_THEME"

# Reiniciar Waybar con el nuevo tema
pkill waybar
sleep 0.5
waybar -c "$THEMES_DIR/$next_theme/config.jsonc" -s "$THEMES_DIR/$next_theme/style.css" &

# Notificar cambio
notify-send "Waybar" "Tema cambiado a: $next_theme" -i preferences-desktop-theme3  
